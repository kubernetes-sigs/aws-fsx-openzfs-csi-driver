# Storage Class Parameters
The AWS FSx for OpenZFS CSI Driver supports the dynamic provisioning of both FSx for OpenZFS file systems AND volumes.

To do this, the driver accepts **TWO** forms of storage classes: one for provisioning new file systems, and one for provisioning new volumes.

## File System Parameters
The user can provide the parameters below when configuring a storage class to dynamically provision a new FSx for OpenZFS **file system**.

Aside from `volumeType`, each of the parameters below map to a corresponding parameter in the FSx API. **PLEASE read the documentation for the FSx [create-file-system](https://docs.aws.amazon.com/cli/latest/reference/fsx/create-file-system.html) API!**

| Parameter                       | Required? | Example Value                                                                                                                                                                                                                                          | Notes                                                                                                                                                |
|---------------------------------|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| `volumeType`                    | Yes       | "filesystem"                                                                                                                                                                                                                                           | Specifies whether the storage class will be used to create an FSx for OpenZFS file system or volume.                                                 |
| `deploymentType`                | Yes       | "SINGLE_AZ_2"                                                                                                                                                                                                                                          |                                                                                                                                                      |
| `throughputCapacity`            | Yes       | "160"                                                                                                                                                                                                                                                  |                                                                                                                                                      |
| `subnetIds`                     | Yes       | "subnet-0eabfaa81fb22bcaf"                                                                                                                                                                                                                             |                                                                                                                                                      |
| `skipFinalBackupOnDeletion`     | Yes       | "true"                                                                                                                                                                                                                                                 | Configures whether or not FSx will create a final backup of the file system. Due to CSI limitations, users may only configure this at creation time. |
| `optionsOnDeletion`             | No        | "[DELETE_CHILD_VOLUMES_AND_SNAPSHOTS]"                                                                                                                                                                                                                 | Configures deletion options for the volume. Due to CSI limitations, users may only configure this at creation time.                                  |
| `kmsKey`                        | No        | "12345678-90ab-cdef-ghij-klmnopqrstuv"                                                                                                                                                                                                                 |                                                                                                                                                      |
| `automaticBackupRetentionDays`  | No        | "1"                                                                                                                                                                                                                                                    |                                                                                                                                                      |
| `copyTagsToBackups`             | No        | "false"                                                                                                                                                                                                                                                |                                                                                                                                                      |
| `copyTagsToVolumes`             | No        | "false"                                                                                                                                                                                                                                                |                                                                                                                                                      |
| `dailyAutomaticBackupStartTime` | No        | "00:00"                                                                                                                                                                                                                                                |                                                                                                                                                      |
| `diskIopsConfiguration`         | No        | "Iops=300,Mode=USER_PROVISIONED"                                                                                                                                                                                                                       |                                                                                                                                                      |
| `rootVolumeConfiguration`       | No        | "CopyTagsToSnapshots=true,<br/>DataCompressionType=NONE,<br/>NfsExports=[{ClientConfigurations=[{Clients=*,Options=[rw,crossmnt]}]}],<br/>ReadOnly=false,<br/>RecordSizeKiB=128,<br/>UserAndGroupQuotas=[{Id=1,StorageCapacityQuotaGiB=10,Type=USER}]" |                                                                                                                                                      |
| `weeklyMaintenanceStartTime`    | No        | "7:09:00"                                                                                                                                                                                                                                              |                                                                                                                                                      |
| `securityGroupIds`              | No        | "sg-068000ccf82dfba88"                                                                                                                                                                                                                                 |                                                                                                                                                      |
| `tags`                          | No        | "Tag1=Value1,Tag2=Value2"                                                                                                                                                                                                                              |                                                                                                                                                      |


## Volume Parameters
The user can provide the parameters below when configuring a storage class to dynamically provision a new FSx for OpenZFS **volume**.

Aside from `volumeType`, each of the parameters below map to a corresponding parameter in the FSx API. **PLEASE read the documentation for the FSx [create-volume](https://docs.aws.amazon.com/cli/latest/reference/fsx/create-volume.html) API!**

| Parameter                       | Required? | Example Value                                                  | Notes                                                                                                               |
|---------------------------------|-----------|----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
| `volumeType`                    | Yes       | "volume"                                                       | Specifies whether the storage class will be used to create an FSx for OpenZFS file system or volume.                |
| `parentVolumeId`                | Yes       | "fsvol-03062e7ff37662dff"                                      |                                                                                                                     |
| `copyTagsToSnapshots`           | No        | "false"                                                        |                                                                                                                     |
| `dataCompressionType`           | No        | "NONE"                                                         |                                                                                                                     |
| `nfsExports`                    | No        | "[{ClientConfigurations=[{Clients=*,Options=[rw,crossmnt]}]}]" |                                                                                                                     |
| `readOnly`                      | No        | "false"                                                        |                                                                                                                     |
| `recordSizeKiB`                 | No        | "128"                                                          |                                                                                                                     |
| `storageCapacityReservationGiB` | No        | "-1"                                                           |                                                                                                                     |
| `storageCapacityQuotaGiB`       | No        | "-1"                                                           |                                                                                                                     |
| `userAndGroupQuotas`            | No        | "[{Id=1,StorageCapacityQuotaGiB=10,Type=USER}]"                |                                                                                                                     |
| `tags`                          | No        | "Tag1=Value1,Tag2=Value2"                                      |                                                                                                                     |
| `optionsOnDeletion`             | No        | "[DELETE_CHILD_VOLUMES_AND_SNAPSHOTS]"                         | Configures deletion options for the volume. Due to CSI limitations, users may only configure this at creation time. |

# Persistent Volume Attributes
The AWS FSx for OpenZFS CSI Driver stores the following volumeAttributes on the persistent volume to aid in mounting the underlying FSx for OpenZFS volume.

When dynamically provisioning new FSx for OpenZFS file systems or volumes as persistent volumes in your cluster, these values are set automatically by the driver itself.

When statically provisioning new FSx for OpenZFS file systems or volumes as persistent volumes in your cluster, the user must provide these values themselves.

| Parameter    | Required?                            | Example Value                                     | Description                                                                                                                                                                             |
|--------------|--------------------------------------|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `volumeType` | Yes                                  | "volume" or "filesystem"                          | Specifies whether the persistent volume contains metadata about an underlying FSx for OpenZFS file system or volume. Mounting a "file system" will mount the file system's root volume. |
| `dnsName`    | Yes                                  | "fs-078106df77a01f1f7.fsx.us-east-1.aws.internal" | DNS name of the FSx for OpenZFS file system associated with the Persistent Volume.                                                                                                      |
| `volumePath` | Required for FSx for OpenZFS volumes | "fsx" or "fsx/exampleVolume"                      | Specifies the mount path for the FSx for OpenZFS volume you wish to mount. If `volumeType` is set to "filesystem," this defaults to "fsx".                                              |
